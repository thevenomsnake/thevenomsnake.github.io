<!DOCTYPE html>


  


<html class="theme-next pisces use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">

<script type="text/javascript">var OriginTitile=document.title,st;document.addEventListener("visibilitychange",function(){document.hidden?(document.title="(/≧▽≦/)Aw, Snap!",clearTimeout(st)):(document.title="(ฅ>ω<*ฅ) Fixed~"+OriginTitile,st=setTimeout(function(){document.title=OriginTitile},3e3))})</script>



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-bounce.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Swift," />










<meta name="description" content="什么嘛，原来我挺会搬运的嘛.JPG">
<meta name="keywords" content="Swift">
<meta property="og:type" content="article">
<meta property="og:title" content="Bundles and Packages">
<meta property="og:url" content="http://www.perphet.com/2019/08/Bundles-and-Packages/index.html">
<meta property="og:site_name" content="Tuski&#39;s Blog">
<meta property="og:description" content="什么嘛，原来我挺会搬运的嘛.JPG">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://i.loli.net/2019/08/18/rS8lzKvmgkqA7FX.png">
<meta property="og:image" content="https://i.loli.net/2019/08/18/S5kMjaqXCR3nNvh.png">
<meta property="og:updated_time" content="2019-08-18T09:51:22.685Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Bundles and Packages">
<meta name="twitter:description" content="什么嘛，原来我挺会搬运的嘛.JPG">
<meta name="twitter:image" content="https://i.loli.net/2019/08/18/rS8lzKvmgkqA7FX.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.perphet.com/2019/08/Bundles-and-Packages/"/>



<link rel="stylesheet" href="../live2d/css/live2d.css" />


  <title>Bundles and Packages | Tuski's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner">
<div class="site-brand-wrapper">
  <div class="site-meta ">
    

   
    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Tuski's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">I code my life</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-music">
          <a href="/music/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-music"></i> <br />
            
            Music
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.perphet.com/2019/08/Bundles-and-Packages/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tuski">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tuski's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Bundles and Packages</h1>
        

        <div class="post-meta">

          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-18T16:21:39+08:00">
                2019-08-18
              </time>
            

            

            
          </span>

          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/08/Bundles-and-Packages/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2019/08/Bundles-and-Packages/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          
             <span id="/2019/08/Bundles-and-Packages/" class="leancloud_visitors" data-flag-title="Bundles and Packages">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  3,048
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  14
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <script src="/assets/js/APlayer.min.js"> </script><blockquote class="blockquote-center">什么嘛，原来我挺会搬运的嘛.JPG</blockquote>

<a id="more"></a>
<p>In this season of giving, let’s stop to consider one of the greatest gifts given to us by modern computer systems: <em>the gift of abstraction</em>.</p>
<p>在这个给予的季节，让我们停下脚步，思考一个现代计算机系统赐予我们的最棒的礼物：抽象。</p>
<p>Consider those billions of people around the world who use computers and mobile devices on a daily basis. They do this without having to know anything about the millions of CPU transistors and SSD sectors and LCD pixels that come together to make that happen. All of this is thanks to abstractions like files and directories and apps and documents.</p>
<p>在数百万 CPU 晶体管、SSD 扇区和 LCD 像素共同协作下，全球数十亿人能够日常使用计算机和移动设备而对此全然不知。这一切都应归功于像文件，目录，应用和文档这样的抽象。</p>
<p>This week on NSHipster, we’ll be talking about two important abstractions on Apple platforms: bundles and packages. 🎁</p>
<p>这周的 NSHipster，我们将讨论苹果平台上两个重要的抽象：包与包裹。🎁</p>
<hr>
<p>Despite being distinct concepts, the terms “bundle” and “package” are frequently used interchangeably. Part of this is undoubtedly due to their similar names, but perhaps the main source of confusion is that many bundles just so happen to be packages (and vice versa).</p>
<p>尽管是不同的概念，包与包裹这两个术语经常会被替换使用。毫无疑问，造成困惑的部分原因出自它们相似的名称，但或许主要原因是许多包恰好也是包裹（反之亦然）。</p>
<p>So before we go any further, let’s define our terminology:</p>
<p>在我们深入之前，先定义一下这两个术语：</p>
<ul>
<li>A bundle is a directory with a known structure that contains executable code and the resources that code uses.</li>
<li><p>A package is a directory that looks like a file when viewed in Finder.</p>
</li>
<li><p>包是指具有已知结构的，包含可执行代码，以及代码所需的资源的目录。</p>
</li>
<li>包裹是指在访达中看起来像是文件的目录。</li>
</ul>
<p>The following diagram illustrates the relationship between bundles and packages, as well as things like apps, frameworks, plugins, and documents that fall into either or both categories:</p>
<p>下图展示了包与包裹之间的关系，将应用、框架包、插件包和文档分别放入一个或多个分类之中：</p>
<p><img src="https://i.loli.net/2019/08/18/rS8lzKvmgkqA7FX.png" alt="QQ20190818-173041.png"></p>
<blockquote>
<p>If you’re still fuzzy on these distinctions, here’s an analogy that might help you keep things straight:</p>
<p>Think of a <em>package</em> as a <em>box</em> (📦) whose contents are sealed away and are considered to exist as a single entity. Contrast that with <em>bundles</em>, which are more like <em>backpacks</em> (🎒) — each with special pockets and compartments for carrying whatever you need, and coming in different configurations depending on whether it’s for taking to school, work, or the gym. If something’s <em>both a bundle and a package</em>, it’s like a piece of <em>luggage</em> (🧳): sealed like a box and organized into compartments like a backpack.</p>
<p>如果对两者的区别你依然感到困惑，这个类比或许能帮助你理解：<br>把包裹想象成是一个内容被隐藏的盒子（📦），作为一个独立的实体而存在。这点与包不同，包更像是一个背包（🎒） —— 每一款都有特殊的口袋和隔层用来携带你需要的东西，不同的配置用以决定是带去学校，去工作，还是去健身房。如果某样东西既是包也是包裹，恰似行李（🧳）一般：像盒子一样浑然一体，像背包一样分隔自如。</p>
</blockquote>
<h1 id="Bundles"><a href="#Bundles" class="headerlink" title="Bundles"></a>Bundles</h1><p>Bundles are primarily for <strong>improving developer experience</strong> by providing structure for organizing code and resources. This structure not only allows for predictable loading of code and resources but allows for system-wide features like localization.</p>
<p>包为代码和资源的组织提供了特定结构，意在<strong>提升开发者的体验</strong>。这个结构不仅允许预测性的加载代码和资源，同时也支持类似于本地化这样的系统性特性。</p>
<p>Bundles fall into one of the following three categories, each with their own particular structure and requirements:</p>
<p>包分属于以下三个类别，每一种都有它自己特殊的结构和要求：</p>
<ul>
<li><p><strong>App Bundles</strong>, which contain an executable that can be launched, an <code>Info.plist</code> file describing the executable, app icons, launch images, and other assets and resources used by the executable, including interface files, strings files, and data files.</p>
</li>
<li><p><strong>Framework Bundles</strong>, which contain code and resources used by the dynamic shared library.</p>
</li>
<li><p><strong>Loadable Bundles</strong> like <em>plug-ins</em>, which contain executable code and resources that extend the functionality of an app. </p>
</li>
<li><p><strong>应用包（App Bundles）</strong>：包含一个能被启动的可执行文件，一个描述可执行文件的 <code>Info.plist</code> 文件，应用图标，启动图片，能被可执行文件调用的接口文件，字符串文件，以及数据文件。</p>
</li>
<li><strong>框架包（Framework Bundles）</strong>：包含动态分享库所需要的代码和资源。</li>
<li><strong>可加载包（Loadable Bundles）</strong>：类似于插件，包含扩展应用功能的可执行代码和资源。</li>
</ul>
<h1 id="Accessing-Bundle-Contents"><a href="#Accessing-Bundle-Contents" class="headerlink" title="Accessing Bundle Contents"></a>Accessing Bundle Contents</h1><p>In apps, playgrounds, and most other contexts the bundle you’re interested in is accessible through the type property <code>Bundle.main</code>. And most of the time, you’ll use <code>url(forResource:withExtension:)</code> (or one of its variants) to get the location of a particular resource.</p>
<p>对于应用，playgrounds，以及其它你感兴趣的包来说，都能通过 <code>Bundle.main</code> 进行访问。大多数情况，可以使用 <code>url(forResource:withExtension:)</code>（或它的一种变体）来获取特定资源的路径。</p>
<p>For example, if your app bundle includes a file named <code>Photo.jpg</code>, you can get a URL to access it like so:</p>
<p>举例来说，如果应用中包含了一个名叫 <code>Photo.jpg</code> 的文件，用下面的方法能获得访问它的 URL：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">`<span class="type">Bundle</span>.main.url(forResource: <span class="string">"Photo"</span>, withExtension: <span class="string">"jpg"</span>)`</div></pre></td></tr></table></figure>
<blockquote>
<p>Or if you’re using the Asset Catalog, you can simply drag &amp; drop from the Media Library (⇧⌘m) to your editor to create an image literal.</p>
<p>如果使用 Asset Catalog，你可以从媒体库（⇧⌘M）拖拽到编辑器来创建图像。</p>
</blockquote>
<p>For everything else, <code>Bundle</code> provides several instance methods and properties that give the location of standard bundle items, with variants returning either a <code>URL</code> or a <code>String</code>paths:</p>
<p>除此之外，<code>Bundle</code> 提供了一些实例方法和变量来获取标准包内容的位置，返回 URL 或 String 类型的路径：</p>
<table>
<thead>
<tr>
<th style="text-align:center">URL</th>
<th style="text-align:center">Path</th>
<th style="text-align:center">Description</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>executableURL</code></td>
<td style="text-align:center"><code>executablePath</code></td>
<td style="text-align:center">The executable</td>
<td>可执行文件</td>
</tr>
<tr>
<td style="text-align:center"><code>url(forAuxiliaryExecutable:)</code></td>
<td style="text-align:center"><code>path(forAuxiliaryExecutable:)</code></td>
<td style="text-align:center">The auxiliary executables</td>
<td>辅助的可执行文件</td>
</tr>
<tr>
<td style="text-align:center"><code>resourceURL</code></td>
<td style="text-align:center"><code>resourcePath</code></td>
<td style="text-align:center">The subdirectory containing resources</td>
<td>包含资源的子目录</td>
</tr>
<tr>
<td style="text-align:center"><code>sharedFrameworksURL</code></td>
<td style="text-align:center"><code>sharedFrameworksPath</code></td>
<td style="text-align:center">The subdirectory containing shared frameworks</td>
<td>包含共享框架的子目录</td>
</tr>
<tr>
<td style="text-align:center"><code>privateFrameworksURL</code></td>
<td style="text-align:center"><code>privateFrameworksPath</code></td>
<td style="text-align:center">The subdirectory containing private frameworks</td>
<td>包含私有框架的子目录</td>
</tr>
<tr>
<td style="text-align:center"><code>builtInPlugInsURL</code></td>
<td style="text-align:center"><code>builtInPlugInsPath</code></td>
<td style="text-align:center">The subdirectory containing plug-ins</td>
<td>包含插件的子目录</td>
</tr>
<tr>
<td style="text-align:center"><code>sharedSupportURL</code></td>
<td style="text-align:center"><code>sharedSupportPath</code></td>
<td style="text-align:center">The subdirectory containing shared support files</td>
<td>包含共享支援文件的子目录</td>
</tr>
<tr>
<td style="text-align:center"><code>appStoreReceiptURL</code></td>
<td style="text-align:center"></td>
<td style="text-align:center">The App Store receipt</td>
<td>App Store 的收据</td>
</tr>
</tbody>
</table>
<h1 id="Getting-App-Information"><a href="#Getting-App-Information" class="headerlink" title="Getting App Information"></a>Getting App Information</h1><p>All app bundles are required to have an <code>Info.plist</code> file that contains information about the app.</p>
<p>所有的应用包都必须有一个包含应用信息的 <code>Info.plist</code> 文件。</p>
<p>Some metadata is accessible directly through instance properties on bundles, including <code>bundleURL</code> and <code>bundleIdentifier</code>.</p>
<p><code>bundleURL</code> 和 <code>bundleIdentifier</code> 这样的原数据能够通过 bundle 实例被直接访问。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> Foundation</div><div class="line"></div><div class="line"><span class="keyword">let</span> bundle = <span class="type">Bundle</span>.main</div><div class="line"></div><div class="line">bundle.bundleURL        <span class="comment">// "/path/to/Example.app"</span></div><div class="line">bundle.bundleIdentifier <span class="comment">// "com.nshipster.example"</span></div></pre></td></tr></table></figure>
<p>You can get any other information by subscript access to the <code>infoDictionary</code> property. (Or if that information is presented to the user, use the <code>localizedInfoDictionary</code> property instead).</p>
<p>通过下标能从 <code>infoDictionary</code> 变量获得其他信息（如果信息要展示给用户，请使用 <code>localizedInfoDictionary</code>）。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">bundle.infoDictionary[<span class="string">"CFBundleName"</span>] <span class="comment">// "Example"</span></div><div class="line">bundle.localizedInfoDictionary[<span class="string">"CFBundleName"</span>] <span class="comment">// "Esempio" (`it_IT` locale)</span></div></pre></td></tr></table></figure>
<h1 id="Getting-Localized-Strings"><a href="#Getting-Localized-Strings" class="headerlink" title="Getting Localized Strings"></a>Getting Localized Strings</h1><p>One of the most important features that bundles facilitate is localization. By enforcing a convention for where localized assets are located, the system can abstract the logic for determining which version of a file to load away from the developer.</p>
<p>包的存在让本地化变得容易。强制本地化资源的存放位置后，系统便能将加载哪个版本的文件的逻辑从开发者层面抽象出来。</p>
<p>For example, bundles are responsible for loading the localized strings used by your app. You can access them using the <code>localizedString(forKey:value:table:)</code> method.</p>
<p>举个例子，包负责加载应用的本地化字符串。使用 <code>localizedString(forKey:value:table:)</code> 方法就可以获取到这些值。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> Foundation</div><div class="line"></div><div class="line"><span class="keyword">let</span> bundle = <span class="type">Bundle</span>.main</div><div class="line">bundle.localizedString(forKey: <span class="string">"Hello, %@"</span>,</div><div class="line">                       value: <span class="string">"Hello, $&#123;username&#125;"</span>,</div><div class="line">                       table: <span class="literal">nil</span>)</div></pre></td></tr></table></figure>
<p>However, it’s almost always a better idea to use <code>NSLocalizedString</code> so that utilities like <code>genstrings</code> can automatically extract keys and comments to <code>.strings</code> files for translation.</p>
<p>然而，通常来说用 <code>NSLocalizedString</code> 会更好，像 <code>genstrings</code> 这样的工具能够自动取出键和注释到 <code>.strings</code> 文件中便于翻译。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="type">NSLocalizedString</span>(<span class="string">"Hello, %@"</span>, comment: <span class="string">"Hello, $&#123;username&#125;"</span>)</div></pre></td></tr></table></figure>
<h2 id="Packages"><a href="#Packages" class="headerlink" title="Packages"></a>Packages</h2><p>Packages are primarily for <strong>improving user experience</strong> by encapsulating and consolidating related resources into a single unit.</p>
<p>包裹把相关资源封装和加固成一个独立单元，意在<strong>提升用户体验</strong>。</p>
<p>A directory is considered to be a package by the Finder if any of the following criteria are met:</p>
<p>满足以下任意一个条件，目录就会被访达认为是包裹：</p>
<ul>
<li>The directory has a special extension like <code>.app</code>, <code>.playground</code>, or <code>.plugin</code></li>
<li>The directory has an extension that an app has registered as a document type</li>
<li><p>The directory has an extended attribute designating it as a package *</p>
</li>
<li><p>目录有类似于 <code>.app</code>，<code>.playground</code> 或 <code>.plugin</code> 等特殊扩展。</p>
</li>
<li>目录有一个被一个应用注册作为文档类型的扩展。</li>
<li>目录具有有扩展属性，将其指定为包裹。</li>
</ul>
<h1 id="Accessing-the-Contents-of-a-Package"><a href="#Accessing-the-Contents-of-a-Package" class="headerlink" title="Accessing the Contents of a Package"></a>Accessing the Contents of a Package</h1><p>In Finder, you can control-click to show a contextual menu with actions to perform on a selected item. If an item is a package, “Show Package Contents” will appear at the top, under “Open”.</p>
<p>在访达中，右键展示选中项目的可操作目录。如果选中项目是包裹，“打开” 操作下会出现 “显示包内容” 选项。</p>
<p><img src="https://i.loli.net/2019/08/18/S5kMjaqXCR3nNvh.png" alt="show-package-contents-c7cc72f58a573cb2fbe349e6f76a4ef29d14fbada3cd9b8376fc37979da16bf3.png"></p>
<p>Selecting this menu item will open a new Finder window from the package directory.</p>
<p>点击这个选项会从包裹目录打开一个新的访达窗口。</p>
<p>You can, of course, access the contents of a package programmatically, too. The best option depends on the kind of package:</p>
<p>当然，也可以通过代码访问包裹中的内容。包裹的类型决定了获取内容的最佳方式：</p>
<ul>
<li>If a package has bundle structure, it’s usually easiest to use <a href="https://developer.apple.com/documentation/foundation/bundle" target="_blank" rel="external"><code>Bundle</code></a> as described in the previous section.</li>
<li>If a package is a document, you can use <a href="https://developer.apple.com/documentation/appkit/nsdocument" target="_blank" rel="external"><code>NSDocument</code></a> on macOS and <a href="https://developer.apple.com/documentation/uikit/uidocument" target="_blank" rel="external"><code>UIDocument</code></a>on iOS.</li>
<li><p>Otherwise, you can use <a href="https://developer.apple.com/documentation/foundation/filewrapper" target="_blank" rel="external"><code>FileWrapper</code></a> to navigate directories, files, and symbolic links, and <a href="https://developer.apple.com/documentation/foundation/filehandle" target="_blank" rel="external"><code>FileHandler</code></a> to read and write to file descriptors.</p>
</li>
<li><p>如果包裹有包的结构，前文所说的 <code>Bundle</code> 就能轻松胜任。</p>
</li>
<li>如果包裹是一个文档，在 macOS 上使用 <code>NSDocument</code> 或在 iOS 上使用 <code>UIDocument</code> 来访问。</li>
<li>其他情况下，用 <code>FileWrapper</code> 导航目录，文件和符号链接，用 <code>FileHandler</code> 来读写文件描述。</li>
</ul>
<h1 id="Determining-if-a-Directory-is-a-Package"><a href="#Determining-if-a-Directory-is-a-Package" class="headerlink" title="Determining if a Directory is a Package"></a>Determining if a Directory is a Package</h1><p>Although it’s up to the Finder how it wants to represent files and directories, most of that is delegated to the operating system and the services responsible for managing Uniform Type Identifiers (UTIs).</p>
<p>虽说是由访达决定如何展示文件和目录，大多数的判断会被代理给操作系统以及管理统一类型标识（UTI）的服务。</p>
<p>To determine whether a file extension is one of the built-in system package types or used by an installed app as a registered document type, access the URL resource <a href="https://developer.apple.com/documentation/foundation/urlresourcekey/1413867-ispackagekey" target="_blank" rel="external"><code>isPackageKey</code></a>:</p>
<p>如果想要确定一个文件扩展是一个内置系统包裹类型，还是一个被已安装的应用使用的文档类型，调用 Core Services 方法 <code>UTTypeCreatePreferredIdentifierForTag(_:_:_:)</code> 与 <code>UTTypeConformsTo(_:_:)</code> 能满足你的需求：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> url: <span class="type">URL</span> = ...</div><div class="line"><span class="keyword">let</span> directoryIsPackage = (<span class="keyword">try</span>? url.resourceValues(forKeys: [.isPackageKey]).isPackage) ?? <span class="literal">false</span></div></pre></td></tr></table></figure>
<p>Or, if you don’t have a <code>URL</code> handy and wanted to check a particular filename extension, you could instead use the Core Services framework to make this determination:</p>
<p>或者，如果没有方便的 URL 想要检查特定的文件拓展名，你可以用 Core Services 框架来做出此决定：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> Foundation</div><div class="line"><span class="keyword">import</span> CoreServices</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">filenameExtensionIsPackage</span><span class="params">(<span class="number">_</span> filenameExtension: String)</span></span> -&gt; <span class="type">Bool</span> &#123;</div><div class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> uti = <span class="type">UTTypeCreatePreferredIdentifierForTag</span>(</div><div class="line">                        kUTTagClassFilenameExtension,</div><div class="line">                        filenameExtension <span class="keyword">as</span> <span class="type">NSString</span>, <span class="literal">nil</span></div><div class="line">                    )?.takeRetainedValue()</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="type">UTTypeConformsTo</span>(uti, kUTTypePackage)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> xcode = <span class="type">URL</span>(fileURLWithPath: <span class="string">"/Applications/Xcode.app"</span>)</div><div class="line">directoryIsPackage(xcode) <span class="comment">// true</span></div></pre></td></tr></table></figure>
<p>If you want to set the so-called “package bit” for a file the hard way (rather than calling <code>URL.setResourceValues(_:)</code>), spelunking through <a href="https://opensource.apple.com/source/CarbonHeaders/CarbonHeaders-8A428/Finder.h" target="_blank" rel="external">CarbonCore/Finder.h</a> indicates that you can do this by setting the <code>kHasBundle</code> (<code>0x2000</code>) flag in the <code>com.apple.FinderInfo</code> extended attribute:</p>
<p>我们找不到任何描述如何设置所谓的包裹比特（package bit）的文档，但根据 <a href="https://opensource.apple.com/source/CarbonHeaders/CarbonHeaders-8A428/Finder.h" target="_blank" rel="external">CarbonCore/Finder.h</a>，在 <code>com.apple.FindlerInfo</code> 扩展参数中设置 <code>kHasBundle（0x2000）</code> 标示能够实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ xattr -wx com.apple.FinderInfo /path/to/package \</div><div class="line">  00 00 00 00 00 00 00 00 20 00 00 00 00 00 00 00 \</div><div class="line">  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</div></pre></td></tr></table></figure>
<hr>
<p>As we’ve seen, it’s not just end-users that benefit from abstractions — whether it’s the safety and expressiveness of a high-level programming language like Swift or the convenience of APIs like Foundation, we as developers leverage abstraction to make great software.</p>
<p>正如我们看到的那样，并非只有终端用户从抽象中获益 —— 无论是像 Swift 这样的高级编程语言的安全性和表现力，还是像 Foundation 这样的 API 的便利性，作为开发者也可以利用抽象开发出优秀的软件。</p>
<p>For all that we may (rightfully) complain about abstractions that are <a href="https://en.wikipedia.org/wiki/Leaky_abstraction" target="_blank" rel="external">leaky</a> or <a href="https://en.wikipedia.org/wiki/Abstraction_inversion" target="_blank" rel="external">inverted</a>, it’s important to take a step back and realize how many useful abstractions we deal with every day, and how much they allow us to do.</p>
<p>或许我们会抱怨 <a href="https://en.wikipedia.org/wiki/Leaky_abstraction" target="_blank" rel="external">抽象泄漏</a> 与 <a href="https://en.wikipedia.org/wiki/Abstraction_inversion" target="_blank" rel="external">抽象反转</a> 带来的问题，但重要的是退一步，了解我们每天处理多少有用的抽象，以及它们带给了我们多少可能性。</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://swift.gg/2019/07/19/nshipster-bundles-and-packages/" target="_blank" rel="external">https://swift.gg/2019/07/19/nshipster-bundles-and-packages/</a></p>
<p><a href="https://nshipster.com/bundles-and-packages/" target="_blank" rel="external">https://nshipster.com/bundles-and-packages/</a></p>

      
    </div>
    
    
    
    <div>
      
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  <!-- JS库 sweetalert 可修改路径 -->
  <script type="text/javascript" src="http://jslibs.wuxubj.cn/sweetalert_mini/jquery-1.7.1.min.js"></script>
  <script src="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.min.js"></script>
  <link rel="stylesheet" type="text/css" href="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.mini.css">
  <p><span>Title:  </span>Bundles and Packages</a></p>
  <p><span>Author:  </span>Tuski</a></p>
  <p><span>Published:  </span>08/18/2019 - 17:21:39</p>
  <p><span>Updated:  </span>08/18/2019 - 17:51:22</p>
  <p><span>Link:  </span><a href="/2019/08/Bundles-and-Packages/" title="Bundles and Packages">http://www.perphet.com/2019/08/Bundles-and-Packages/</a>
    <span class="copy-path"  title="Click to Copy article link"><i class="fa fa-clipboard" data-clipboard-text="http://www.perphet.com/2019/08/Bundles-and-Packages/"  aria-label="Copy successfully！"></i></span>
  </p>
  <p><span>Protocol:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)</a> Reprinted please keep the original link and author</p>  
</div>
<script>
    var clipboard = new Clipboard('.fa-clipboard');
    clipboard.on('success', $(function(){
      $(".fa-clipboard").click(function(){
        swal({   
          title: "",   
          text: 'Copy successfully！',   
          html: false,
          timer: 500,   
          showConfirmButton: false
        });
      });
    }));  
</script>

      
    </div>

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>Thx F Sup</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>Donate</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="https://i.loli.net/2017/12/16/5a33fd668ce7c.png" alt="Tuski WeChat Pay"/>
        <p>WeChat Pay</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="https://i.loli.net/2017/12/16/5a33fdbe62e6f.png" alt="Tuski Alipay"/>
        <p>Alipay</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Swift/" rel="tag"><i class="fa fa-tag"></i> Swift</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        
          <div class="wp_rating">
         
            <div id="wpac-rating"></div>
          </div>
        

        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/08/OC-Runtime/" rel="next" title="OC Runtime">
                <i class="fa fa-chevron-left"></i> OC Runtime
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/09/Ways-to-solve-could-not-build-objective-c-module/" rel="prev" title="Ways to solve 'could not build objective-c module'">
                Ways to solve 'could not build objective-c module' <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        <!-- Go to www.addthis.com/dashboard to customize your tools -->
<div class="addthis_inline_share_toolbox">
  <script type = "text/javascript" src = "//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5a35fec5ad889f1e" async = "async" ></script>
</div>

      
    </div>
  </div>


          </div>
          


          
  
    <div class="comments" id="comments">
      <div id="hypercomments_widget"></div>
    </div>
  


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="Tuski" />
            
              <p class="site-author-name" itemprop="name">Tuski</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">45</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">38</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/thevenomsnake" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:thevenomsnake@icloud.com" target="_blank" title="E-Mail">
                    
                      <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://plus.google.com/u/0/104624402456467592306" target="_blank" title="Google">
                    
                      <i class="fa fa-fw fa-google"></i>Google</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://twitter.com/perphet" target="_blank" title="Twitter">
                    
                      <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.youtube.com/channel/UComQu3jg43YgIvm2PqAG1tA" target="_blank" title="YouTube">
                    
                      <i class="fa fa-fw fa-youtube"></i>YouTube</a>
                </span>
              
            
          </div>

          
          


  <div class="links-of-blogroll motion-element links-of-blogroll-block">
    <div class="links-of-blogroll-title">
      <i class="fa  fa-fw fa-globe"></i>
      Links&nbsp;
      <i class="fa  fa-fw fa-globe"></i>
    </div>
    <ul class="links-of-blogroll-list">
      
        <li class="links-of-blogroll-item">
          <a href="https://blog.crazyforcode.org/" title="CFC" target="_blank">CFC</a>
        </li>
      
    </ul>
     
  </div>
 

          
      <iframe src="https://open.spotify.com/embed?uri=spotify:user:spotify:playlist:37i9dQZF1DXcBWIGoYBM5M&theme=white" width="215" height="350" frameborder="0" allowtransparency="true"></iframe>
       
      </section>


      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Bundles"><span class="nav-text">Bundles</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Accessing-Bundle-Contents"><span class="nav-text">Accessing Bundle Contents</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Getting-App-Information"><span class="nav-text">Getting App Information</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Getting-Localized-Strings"><span class="nav-text">Getting Localized Strings</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Packages"><span class="nav-text">Packages</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Accessing-the-Contents-of-a-Package"><span class="nav-text">Accessing the Contents of a Package</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Determining-if-a-Directory-is-a-Package"><span class="nav-text">Determining if a Directory is a Package</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Reference"><span class="nav-text">Reference</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="heart">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tuski</span>



  
</div>




  <div class="powered-by">Powered by </div>



  <span class="post-meta-divider">Perphet</span>


<!--

  <div class="theme-info">Theme &mdash;  v{}</div>




-->






        







        
      </div>
    </footer>

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  










  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	

		<script type="text/javascript">
		_hcwp = window._hcwp || [];

		_hcwp.push({widget:"Bloggerstream", widget_id: 99037, selector:".hc-comment-count", label: "{\%COUNT%\}" });

		
		_hcwp.push({widget:"Stream", widget_id: 99037, xid: "2019/08/Bundles-and-Packages/"});
		

		(function() {
		if("HC_LOAD_INIT" in window)return;
		HC_LOAD_INIT = true;
		var lang = (navigator.language || navigator.systemLanguage || navigator.userLanguage || "en").substr(0, 2).toLowerCase();
		var hcc = document.createElement("script"); hcc.type = "text/javascript"; hcc.async = true;
		hcc.src = ("https:" == document.location.protocol ? "https" : "http")+"://w.hypercomments.com/widget/hc/99037/"+lang+"/widget.js";
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(hcc, s.nextSibling);
		})();
		</script>

	












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("c6sjJ6fGADGrCVC48k5MVQcD-gzGzoHsz", "YuTcQ8aPXftmtmeC4VvTrK9B");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  
  <script type="text/javascript">
  wpac_init = window.wpac_init || [];
  wpac_init.push({widget: 'Rating', id: 8566,
    el: 'wpac-rating',
    color: 'fc6423'
  });
  (function() {
    if ('WIDGETPACK_LOADED' in window) return;
    WIDGETPACK_LOADED = true;
    var mc = document.createElement('script');
    mc.type = 'text/javascript';
    mc.async = true;
    mc.src = '//embed.widgetpack.com/widget.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(mc, s.nextSibling);
  })();
  </script>


  

  

  

  
<div id="hexo-helper-live2d">
  <canvas id="live2dcanvas" width="150" height="350"></canvas>
</div>
<style>
  #live2dcanvas{
    position: fixed;
    width: 150px;
    height: 350px;
    opacity:0.8;
    right: 0px;
    z-index: 999;
    pointer-events: none;
    bottom: -20px;
  }
</style>
<script type="text/javascript" src="/live2d/device.min.js"></script>
<script type="text/javascript">
const loadScript = function loadScript(c,b){var a=document.createElement("script");a.type="text/javascript";"undefined"!=typeof b&&(a.readyState?a.onreadystatechange=function(){if("loaded"==a.readyState||"complete"==a.readyState)a.onreadystatechange=null,b()}:a.onload=function(){b()});a.src=c;document.body.appendChild(a)};
(function(){
  if((typeof(device) != 'undefined') && (device.mobile())){
    var trElement = document.getElementById('hexo-helper-live2d');
    trElement.parentNode.removeChild(trElement);
    return;
  }else
    if (typeof(device) === 'undefined') console.error('Cannot find current-device script.');
  loadScript("/live2d/script.js", function(){loadlive2d("live2dcanvas", "/live2d/assets/shizuku.model.json", 0.5);});
})();
</script>

 <canvas class="fireworks" 
        style="position: fixed; left: 0px; top: 0px; z-index: 99999999; pointer-events: none; width: 1158px; height: 916px;" 
        width="2316" 
        height="1832">
</canvas>
<script type="text/javascript" src="/js/src/anime.min.js"></script>
<script type="text/javascript" src="/js/src/fireworks.js"></script>
</body>
</html>
